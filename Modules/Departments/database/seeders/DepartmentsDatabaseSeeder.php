<?php

namespace Modules\Departments\Database\Seeders;

use Illuminate\Database\Seeder;
use Modules\Departments\Models\Department;

class DepartmentsDatabaseSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {

        // لنفترض أن المستخدم الإداري الأول هو الذي أنشأ الأقسام
        $creator_type = 'Modules\AuthCore\Models\User';
        $creator_id = 1;


        // الأقسام الرئيسية
        $departments = [
            'الإدارة العامة',
            'الموارد البشرية',
            'الشؤون المالية',
            'المبيعات',
            'التسويق',
            'الإنتاج/العمليات',
            'تقنية المعلومات',
            'الشؤون القانونية',
            'البحث والتطوير',
            'المشتريات',
            'خدمة العملاء'
        ];

        $departmentIds = [];

        // إنشاء الأقسام الرئيسية
        foreach ($departments as $name) {
            $department = Department::create([
                'name' => $name,
                'description' => $this->getDescription($name),
                'parent_id' => null,
                'creator_type' => $creator_type,
                'creator_id' => $creator_id

            ]);
            $departmentIds[$name] = $department->id;
        }

        // الأقسام الفرعية
        $subDepartments = [
            'الموارد البشرية' => ['التوظيف', 'التدريب', 'العلاقات العمالية'],
            'الشؤون المالية' => ['المحاسبة', 'التدقيق', 'المرتبات'],
            'التسويق' => ['التسويق الرقمي', 'العلامة التجارية', 'بحوث السوق'],
            'الإنتاج/العمليات' => ['التخطيط', 'مراقبة الجودة', 'المستودعات'],
            'تقنية المعلومات' => ['الشبكات', 'الأنظمة', 'دعم المستخدمين'],
            'المبيعات' => ['المبيعات المحلية', 'المبيعات الدولية'],
            'الشؤون القانونية' => ['العقود', 'الامتثال', 'قضايا الشركات'],
            'خدمة العملاء' => ['الدعم الهاتفي', 'الدعم الفني', 'المراسلات'],
            'البحث والتطوير' => ['ابتكار المنتجات', 'تطوير النماذج الأولية'],
        ];

        foreach ($subDepartments as $parent => $subs) {
            foreach ($subs as $sub) {
                Department::create([
                    'name' => $sub,
                    'description' => null,
                    'parent_id' => $departmentIds[$parent],
                    'creator_type' => $creator_type,
                    'creator_id' => $creator_id
                ]);
            }
        }
    }

    private function getDescription($name)
    {
        return match($name) {
            'الإدارة العامة' => 'التخطيط العام، اتخاذ القرارات الاستراتيجية',
            'الموارد البشرية' => 'التوظيف، العقود، التدريب، التقييم، الرواتب',
            'الشؤون المالية' => 'إعداد الميزانية، المرتبات، الفواتير، الضرائب',
            'المبيعات' => 'متابعة العملاء، إغلاق الصفقات',
            'التسويق' => 'الحملات الإعلانية، العلامة التجارية، دراسة السوق',
            'الإنتاج/العمليات' => 'إدارة سلسلة التوريد، التصنيع، مراقبة الجودة',
            'تقنية المعلومات' => 'البنية التحتية التقنية، الدعم الفني، الأمن السيبراني',
            'الشؤون القانونية' => 'إدارة العقود، القضايا القانونية، السياسات',
            'البحث والتطوير' => 'تطوير المنتجات، الابتكار',
            'المشتريات' => 'شراء المواد والخدمات من الموردين',
            'خدمة العملاء' => 'دعم العملاء، تلقي الشكاوى والاستفسارات',
            default => null
        };
    }

}
